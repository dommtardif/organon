<!DOCTYPE html>
<html>

    <head>
        <title>Organon</title>
        <meta name="description" content="Visualisateur de logique" />
        <!-- Copyright 1998-2018 by Northwoods Software Corporation. -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <script src="./js/gojs/go.js"></script>
        <script id="code">
            // Definir la sous classe de forcedirected layout pour avoir un update en temps reel du diagramme
            function ContinuousForceDirectedLayout() {
                go.ForceDirectedLayout.call(this);
                this._isObserving = false;
            }
            go.Diagram.inherit(ContinuousForceDirectedLayout, go.ForceDirectedLayout);

            /** @override */
            ContinuousForceDirectedLayout.prototype.isFixed = function (v) {
                return v.node.isSelected;
            };

            /** @override */
            ContinuousForceDirectedLayout.prototype.doLayout = function (coll) {
                if (!this._isObserving) {
                    this._isObserving = true;
                    var lay = this;
                    this.diagram.addModelChangedListener(function (e) {
                        if (e.modelChange !== "" ||
                                (e.change === go.ChangedEvent.Transaction && e.propertyName === "StartingFirstTransaction")) {
                            lay.network = null;
                        }
                    });
                }
                var net = this.network;
                if (net === null) {  // the first time, just create the network as normal
                    this.network = net = this.makeNetwork(coll);
                } else {  // but on reuse we need to update the LayoutVertex.bounds for selected nodes
                    this.diagram.nodes.each(function (n) {
                        var v = net.findVertex(n);
                        if (v !== null)
                            v.bounds = n.actualBounds;
                    });
                }
                // now perform the normal layout
                go.ForceDirectedLayout.prototype.doLayout.call(this, coll);
                // doLayout normally discards the LayoutNetwork by setting Layout.network to null;
                // here we remember it for next time
                this.network = net;
            };

            function init() {
                //Initialisation de goJS et du diagramme
                var GOMAKE = go.GraphObject.make;

                myDiagram =
                        GOMAKE(go.Diagram, "myDiagramDiv", // create a Diagram for the DIV HTML element
                                {
                                    initialContentAlignment: go.Spot.Center,
                                    //layout: new go.ForceDirectedLayout(),
                                    layout:
                                            GOMAKE(ContinuousForceDirectedLayout, // automatically spread nodes apart while dragging
                                                    {defaultSpringLength: 30, defaultElectricalCharge: 30}),
                                    // do an extra layout at the end of a move
                                    "SelectionMoved": function (e) {
                                        e.diagram.layout.invalidateLayout();
                                    },
                                    //"LinkDrawn": maybeChangeLinkCategory, // these two DiagramEvents call a
                                    //"LinkRelinked": maybeChangeLinkCategory, // function that is defined below
                                    // allow double-click in background to create a new node
                                    "clickCreatingTool.archetypeNodeData": {
                                        text: "Énoncé",
                                        color: "gold"
                                    },

                                    // allow Ctrl-G to call groupSelection()
                                    "commandHandler.archetypeGroupData": {
                                        text: "Groupe",
                                        isGroup: true,
                                        color: "blue"
                                    },
                                    // have mouse wheel events zoom in and out instead of scroll up and down
                                    "toolManager.mouseWheelBehavior": go.ToolManager.WheelZoom,
                                    // enable undo & redo
                                    "undoManager.isEnabled": true
                                });

                //Fonctions de support pour le diagramme
                function makeButton(text, action, visiblePredicate) {
                    return GOMAKE("ContextMenuButton",
                            GOMAKE(go.TextBlock, text), {
                        click: action
                    },
                            // don't bother with binding GraphObject.visible if there's no predicate
                            visiblePredicate ? new go.Binding("visible", "", function (o, e) {
                                return o.diagram ? visiblePredicate(o, e) : false;
                            }).ofObject() : {});
                }

                function changeNodeBackground(obj, color) {
                    var contextmenu = obj.part; // the Button is in the context menu Adornment
                    var part = contextmenu.adornedPart; // the adornedPart is the Part that the context menu adorns
                    // now can do something with PART, or with its data, or with the Adornment (the context menu)
                    if (part instanceof go.Node) {
                        obj.diagram.startTransaction("Change node color");
                        var shape = part.findObject("SHAPE");
                        shape.fill = color;
                        obj.diagram.commitTransaction("Change node color");
                    }
                }

                //Functions to display info for different parts
                function groupInfo(adornment) { // takes the tooltip or context menu, not a group node data object
                    var g = adornment.adornedPart; // get the Group that the tooltip adorns
                    var mems = g.memberParts.count;
                    var links = 0;
                    g.memberParts.each(function (part) {
                        if (part instanceof go.Link)
                            links++;
                    });
                    return "Group " + g.data.key + ": " + g.data.text + "\n" + mems + " members including " + links + " links";
                }

                function nodeInfo(d) { // Tooltip info for a node data object
                    var str = "Node " + d.key + ": " + d.text + "\n";
                    if (d.group)
                        str += "member of " + d.group;
                    else
                        str += "top-level node";
                    return str;
                }

                function linkInfo(d) { // Tooltip info for a link data object
                    return "Link:\nfrom " + d.from + " to " + d.to;
                }

                function createArgument(e, selection) {
                    var diagram = e.diagram;
                    var selArray = new Array();
                    var group = {isGroup: true, text: "Argument"};
                    diagram.model.makeNodeDataKeyUnique(group);
                    diagram.model.setCategoryForNodeData(group, "argument");

                    var premisse = selection.iterator;
                    while (premisse.next()) {
                        selArray.push(premisse.value);
                    }

                    diagram.startTransaction("Create argument");

                    if (selArray.length > 1) {
                        var conclusion = selArray.pop();
                        var cdata = conclusion.data;
                        diagram.model.setCategoryForNodeData(cdata, "conclusion");
                        cdata.color = "blue";

                        var centrex = (conclusion.location.x + selArray[0].location.x) / 2;
                        var centrey = (conclusion.location.y + selArray[0].location.y) / 2;
                        var centre = {"loc": centrex.toString() + " " + centrey.toString()};
                        diagram.model.makeNodeDataKeyUnique(centre);
                        diagram.model.setCategoryForNodeData(centre, "deduction");
                        diagram.model.addNodeData(centre);
                        diagram.model.addNodeData(group);

                        diagram.select(conclusion);
                        for (var i = 0; i < selArray.length; i++) {
                            diagram.model.addLinkData({from: diagram.model.getKeyForNodeData(selArray[i].data), to: diagram.model.getKeyForNodeData(centre), category: "linkToLink"});
                        }
                        diagram.model.addLinkData({from: diagram.model.getKeyForNodeData(centre), to: diagram.model.getKeyForNodeData(cdata)});

                        diagram.model.setGroupKeyForNodeData(conclusion.data, diagram.model.getKeyForNodeData(group));
                        diagram.model.setGroupKeyForNodeData(centre, diagram.model.getKeyForNodeData(group));

                        for (var i = 0; i < selArray.length; i++) {
                            diagram.model.setGroupKeyForNodeData(selArray[i].data, diagram.model.getKeyForNodeData(group));
                        }
                        diagram.commitTransaction("Create argument");

                    } else {
                        diagram.model.addLinkData({from: diagram.model.getKeyForNodeData(selArray[0].data), to: diagram.model.getKeyForNodeData(selArray[0].data)});
                        diagram.select(selArray[0]);
                        diagram.commitTransaction("Create argument");
                    }
                }

                function addNodeToRight(e, obj) {
                    var adornment = obj.part;
                    var diagram = e.diagram;
                    diagram.startTransaction("Add node");

                    // get the node data for which the user clicked the button
                    var fromNode = adornment.adornedPart;
                    var fromData = fromNode.data;
                    // create a new "State" data object, positioned off to the right of the adorned Node
                    var toData = {
                        text: "Énoncé",
                        color: fromNode.data.color
                    };
                    if (fromData.hasOwnProperty("group")) {
                        toData.group = fromData.group;
                    }
                    var p = fromNode.location.copy();
                    p.x += 100;
                    toData.loc = go.Point.stringify(p); // the "loc" property is a string, not a Point object
                    // add the new node data to the model
                    var model = diagram.model;
                    model.addNodeData(toData);

                    // select the new Node
                    var newnode = diagram.findNodeForData(toData);
                    diagram.select(newnode);

                    diagram.commitTransaction("Add node");

                    // if the new node is off-screen, scroll the diagram to show the new node
                    diagram.scrollToRect(newnode.actualBounds);
                }

                //Configuration du layout
                var lay = myDiagram.layout;
                lay.maxIterations = 100;
                lay.epsilon = 1;
                lay.infinity = 1000;
                var arrangementSpacing = new go.Size();
                arrangementSpacing.width = 10;
                arrangementSpacing.height = 10;
                lay.arrangementSpacing = arrangementSpacing;
                lay.defaultElectricalCharge = 50;
                lay.defaultGravitationalMass = 20;
                lay.defaultSpringStiffness = 0.05;
                lay.defaultSpringLength = 20;
                lay.comments = true;

                //Definitions des objets et templates

                var nodeContextMenu = GOMAKE(go.Adornment, "Vertical",
                        makeButton("Propriétés",
                                function (e, obj) { // OBJ is this Button
                                    var contextmenu = obj.part; // the Button is in the context menu Adornment
                                    var part = contextmenu.adornedPart; // the adornedPart is the Part that the context menu adorns
                                    // now can do something with PART, or with its data, or with the Adornment (the context menu)
                                    if (part instanceof go.Link)
                                        alert(linkInfo(part.data));
                                    else if (part instanceof go.Group)
                                        alert(groupInfo(contextmenu));
                                    else
                                        alert(nodeInfo(part.data));
                                }),
                        makeButton("Conclusion", // TODO Changer la propriete conclusion par une categorie conclusion avec un template
                                function (e, obj) { // OBJ is this Button
                                    var contextmenu = obj.part; // the Button is in the context menu Adornment
                                    var part = contextmenu.adornedPart; // the adornedPart is the Part that the context menu adorns
                                    // now can do something with PART, or with its data, or with the Adornment (the context menu)
                                    if (part instanceof go.Node) {
                                        if (part.data.category === "conclusion") {
                                            changeNodeBackground(obj, "gold");
                                            e.diagram.model.setCategoryForNodeData(part.data, "");
                                        } else if (!part.data.conclusion) {
                                            changeNodeBackground(obj, "blue");
                                            e.diagram.model.setCategoryForNodeData(part.data, "conclusion");
                                        } else
                                            alert("Erreur");
                                    }
                                },
                                function (o) {
                                    return o.diagram.selection.count === 1 && o.diagram.selection.first() instanceof go.Node;
                                }),
                        makeButton("Couper",
                                function (e, obj) {
                                    e.diagram.commandHandler.cutSelection();
                                },
                                function (o) {
                                    return o.diagram.commandHandler.canCutSelection();
                                }),
                        makeButton("Copier",
                                function (e, obj) {
                                    e.diagram.commandHandler.copySelection();
                                },
                                function (o) {
                                    return o.diagram.commandHandler.canCopySelection();
                                }),
                        makeButton("Coller",
                                function (e, obj) {
                                    e.diagram.commandHandler.pasteSelection(e.diagram.lastInput.documentPoint);
                                },
                                function (o) {
                                    return o.diagram.commandHandler.canPasteSelection();
                                }),
                        makeButton("Supprimer",
                                function (e, obj) {
                                    e.diagram.commandHandler.deleteSelection();
                                },
                                function (o) {
                                    return o.diagram.commandHandler.canDeleteSelection();
                                }),
                        makeButton("Annuler",
                                function (e, obj) {
                                    e.diagram.commandHandler.undo();
                                },
                                function (o) {
                                    return o.diagram.commandHandler.canUndo();
                                }),
                        makeButton("Refaire",
                                function (e, obj) {
                                    e.diagram.commandHandler.redo();
                                },
                                function (o) {
                                    return o.diagram.commandHandler.canRedo();
                                }),
                        makeButton("Grouper",
                                function (e, obj) {
                                    e.diagram.commandHandler.groupSelection();
                                },
                                function (o) {
                                    return o.diagram.commandHandler.canGroupSelection();
                                }),
                        makeButton("Dégrouper",
                                function (e, obj) {
                                    e.diagram.commandHandler.ungroupSelection();
                                },
                                function (o) {
                                    return o.diagram.commandHandler.canUngroupSelection();
                                }),
                        makeButton("Dégrouper",
                                function (e, obj) {
                                    //var partlist = new go.List(go.Part);
                                    //var contextmenu = obj.part; // the Button is in the context menu Adornment
                                    //var part = contextmenu.adornedPart; // the adornedPart is the Part that the context menu adorns
                                    //partlist.add(part);
                                    // now can do something with PART, or with its data, or with the Adornment (the context menu)
                                    e.diagram.commandHandler.addTopLevelParts(e.diagram.selection, true);
                                },
                                function (o) {
                                    //var part = o.part; // the adornedPart is the Part that the context menu adorns
                                    // now can do something with PART, or with its data, or with the Adornment (the context menu)
                                    return o.data.hasOwnProperty("group") && !o.diagram.commandHandler.canUngroupSelection()
                                            && o.diagram.selection.count > 0;
                                    //return false
                                }),
                        makeButton("Construire Argument",
                                function (e, obj) {
                                    createArgument(obj, obj.diagram.selection);
                                },
                                function (o) {
                                    //alert(o.diagram.selection.count);
                                    return o.diagram.selection.count >= 1;
                                })
                        );
                // define the Node template
                myDiagram.nodeTemplate =
                        GOMAKE(go.Node, "Auto",
                                new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
                                new go.Binding("visible", "visible").makeTwoWay(),
                                new go.Binding("conclusion", "conclusion", Boolean).makeTwoWay(),
                                // define the node's outer shape, which will surround the TextBlock
                                GOMAKE(go.Shape, "RoundedRectangle", {
                                    parameter1: 20, // the corner has a large radius
                                    fill: "gold",
                                    stroke: null,
                                    portId: "", // this Shape is the Node's port, not the whole Node
                                    fromLinkable: true,
                                    fromLinkableSelfNode: true,
                                    fromLinkableDuplicates: true,
                                    toLinkable: true,
                                    toLinkableSelfNode: true,
                                    toLinkableDuplicates: true,
                                    cursor: "pointer",
                                    name: "SHAPE"
                                },
                                        new go.Binding("fill", "color").makeTwoWay()
                                        ),
                                GOMAKE(go.Panel, "Vertical",
                                        GOMAKE(go.TextBlock, {
                                            font: "bold 11pt helvetica, bold arial, sans-serif",
                                            editable: true // editing the text automatically updates the model data
                                        },
                                                new go.Binding("text").makeTwoWay()
                                                ),
                                        GOMAKE("TreeExpanderButton")
                                        ), {
                            // the same context menu Adornment is shared by all groups
                            contextMenu: nodeContextMenu
                        }
                        );

                // Ajouter un boutton d'ajout lorsqu'une premisse est selectionnee
                myDiagram.nodeTemplate.selectionAdornmentTemplate =
                        GOMAKE(go.Adornment, "Spot",
                                GOMAKE(go.Panel, "Auto",
                                        GOMAKE(go.Shape, {
                                            fill: null,
                                            stroke: "blue",
                                            strokeWidth: 2
                                        }),
                                        GOMAKE(go.Placeholder) // a Placeholder sizes itself to the selected Node
                                        ),
                                // the button to create a "next" node, at the top-right corner
                                GOMAKE("Button",
                                        {
                                            alignment: go.Spot.TopRight,
                                            click: addNodeToRight  // this function is defined below
                                        },
                                        GOMAKE(go.Shape, "PlusLine", {width: 6, height: 6})
                                        ) // end button
                                ); // end Adornment



                // Template pour le noeud central d'un argument
                myDiagram.nodeTemplateMap.add("deduction",
                        GOMAKE("Node", {
                            selectable: true,
                            avoidable: true,
                            layerName: "Foreground"
                        }, // always have link label nodes in front of Links
                                new go.Binding("visible", "visible").makeTwoWay(),
                                GOMAKE("Shape", "Ellipse", {
                                    width: 5,
                                    height: 5,
                                    stroke: null,
                                    portId: "",
                                    fromLinkable: true,
                                    toLinkable: true,
                                    cursor: "pointer"
                                })
                                ),
                        GOMAKE(go.TextBlock, {
                            font: "bold 11pt helvetica, bold arial, sans-serif",
                            editable: true // editing the text automatically updates the model data
                        },
                                new go.Binding("text").makeTwoWay()
                                )

                        );
                myDiagram.nodeTemplateMap.add("conclusion",
                        GOMAKE(go.Node, "Auto",
                                new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
                                new go.Binding("visible", "visible").makeTwoWay(),
                                new go.Binding("conclusion", "conclusion", Boolean).makeTwoWay(),
                                // define the node's outer shape, which will surround the TextBlock
                                GOMAKE(go.Shape, "RoundedRectangle", {
                                    parameter1: 20, // the corner has a large radius
                                    fill: "blue",
                                    stroke: null,
                                    portId: "", // this Shape is the Node's port, not the whole Node
                                    fromLinkable: true,
                                    fromLinkableSelfNode: true,
                                    fromLinkableDuplicates: true,
                                    toLinkable: true,
                                    toLinkableSelfNode: true,
                                    toLinkableDuplicates: true,
                                    cursor: "pointer",
                                    name: "SHAPE"
                                },
                                        new go.Binding("fill", "color").makeTwoWay()
                                        ),
                                GOMAKE(go.Panel, "Vertical",
                                        GOMAKE(go.TextBlock, {
                                            font: "bold 11pt helvetica, bold arial, sans-serif",
                                            editable: true // editing the text automatically updates the model data
                                        },
                                                new go.Binding("text").makeTwoWay()
                                                ),
                                        GOMAKE("TreeExpanderButton")
                                        ), {
                            // the same context menu Adornment is shared by all groups
                            contextMenu: nodeContextMenu
                        }
                        ));
                // Liens ordinaires
                myDiagram.linkTemplate =
                        GOMAKE("Link", // the whole link panel
                                {
                                    curve: go.Link.JumpGap,
                                    adjusting: go.Link.Stretch,
                                    corner: 15,
                                    reshapable: true,
                                    relinkableFrom: true,
                                    relinkableTo: true,
                                    toShortLength: 3,
                                    routing: go.Link.Normal
                                },
                                new go.Binding("points").makeTwoWay(),
                                new go.Binding("curviness"),
                                GOMAKE(go.Shape, // the link shape
                                        {
                                            strokeWidth: 1.5
                                        }),
                                GOMAKE(go.Shape, // the arrowhead
                                        {
                                            toArrow: "standard",
                                            stroke: null
                                        }),
                                GOMAKE(go.Panel, "Auto",
                                        GOMAKE(go.TextBlock, "transition", // the label text
                                                {
                                                    textAlign: "center",
                                                    font: "9pt helvetica, arial, sans-serif",
                                                    margin: 4,
                                                    editable: true // enable in-place editing
                                                },
                                                // editing the text automatically updates the model data
                                                new go.Binding("text").makeTwoWay())
                                        ), {
                            // the same context menu Adornment is shared by all groups
                            contextMenu: nodeContextMenu
                        }
                        );

                // Template des liens vers des liens, c.a.d. le noeud central
                myDiagram.linkTemplateMap.add("linkToLink",
                        GOMAKE("Link", // the whole link panel
                                {
                                    curve: go.Link.JumpGap,
                                    adjusting: go.Link.Stretch,
                                    isLayoutPositioned: true,
                                    corner: 15,
                                    reshapable: true,
                                    relinkableFrom: true,
                                    relinkableTo: true,
                                    toShortLength: 3,
                                    routing: go.Link.Normal
                                },
                                new go.Binding("points").makeTwoWay(),
                                new go.Binding("curviness"),
                                GOMAKE(go.Shape, // the link shape
                                        {
                                            strokeWidth: 1.5
                                        }), {
                            // the same context menu Adornment is shared by all groups
                            contextMenu: nodeContextMenu
                        }

                        )

                        );
                //Template pour les groupes
                myDiagram.groupTemplate =
                        GOMAKE(go.Group, "Vertical", {
                            selectionObjectName: "PANEL", // selection handle goes around shape, not label
                            ungroupable: true,
                            layout: GOMAKE(go.ForceDirectedLayout, // automatically spread nodes apart while dragging
                                    {defaultSpringLength: 25, defaultElectricalCharge: 50}),
                            fromSpot: go.Spot.Bottom, // coming out from middle-right
                            toSpot: go.Spot.Top
                        }, // enable Ctrl-Shift-G to ungroup a selected Group
                                GOMAKE(go.Panel, "Horizontal",
                                        GOMAKE(go.TextBlock, {
                                            font: "bold 19px sans-serif",
                                            isMultiline: false, // don't allow newlines in text
                                            editable: true // allow in-place editing by user
                                        },
                                                new go.Binding("text", "text").makeTwoWay(),
                                                new go.Binding("stroke", "color")),
                                        GOMAKE("SubGraphExpanderButton"),
                                        GOMAKE("TreeExpanderButton")
                                        ),
                                GOMAKE(go.Panel, "Auto", {
                                    name: "PANEL"
                                },
                                        GOMAKE(go.Shape, "RoundedRectangle", // the rectangular shape around the members
                                                {
                                                    parameter1: 15,
                                                    fill: "rgba(128,128,128,0.2)",
                                                    stroke: "gray",
                                                    strokeWidth: 3,
                                                    portId: "",
                                                    cursor: "pointer", // the Shape is the port, not the whole Node
                                                    // allow all kinds of links from and to this port
                                                    fromLinkable: true,
                                                    fromLinkableSelfNode: true,
                                                    fromLinkableDuplicates: true,
                                                    toLinkable: true,
                                                    toLinkableSelfNode: true,
                                                    toLinkableDuplicates: true
                                                }),
                                        GOMAKE(go.Placeholder, {
                                            margin: 10,
                                            background: "transparent"
                                        }) // represents where the members are
                                        ), {
                            // the same context menu Adornment is shared by all groups
                            contextMenu: nodeContextMenu
                        }
                        );
                myDiagram.groupTemplateMap.add("argument",
                        GOMAKE(go.Group, "Vertical", {
                            selectionObjectName: "PANEL", // selection handle goes around shape, not label
                            ungroupable: true,
                            layout: GOMAKE(go.ForceDirectedLayout, // automatically spread nodes apart while dragging
                                    {defaultSpringLength: 25, defaultElectricalCharge: 50}),
                            fromSpot: go.Spot.Bottom, // coming out from middle-right
                            toSpot: go.Spot.Top
                        }, // enable Ctrl-Shift-G to ungroup a selected Group
                                GOMAKE(go.Panel, "Horizontal",
                                        GOMAKE("SubGraphExpanderButton"),
                                        GOMAKE("TreeExpanderButton")
                                        ),
                                GOMAKE(go.Panel, "Auto", {
                                    name: "PANEL"
                                },
                                        GOMAKE(go.Shape, "RoundedRectangle", // the rectangular shape around the members
                                                {
                                                    parameter1: 15,
                                                    fill: "ghostwhite",
                                                    stroke: "whitesmoke",
                                                    strokeWidth: 3,
                                                    portId: "",
                                                    cursor: "pointer", // the Shape is the port, not the whole Node
                                                    // allow all kinds of links from and to this port
                                                    fromLinkable: true,
                                                    fromLinkableSelfNode: true,
                                                    fromLinkableDuplicates: true,
                                                    toLinkable: true,
                                                    toLinkableSelfNode: true,
                                                    toLinkableDuplicates: true
                                                }),
                                        GOMAKE(go.Placeholder, {
                                            margin: 10,
                                            background: "transparent"
                                        }) // represents where the members are
                                        ), {
                            // the same context menu Adornment is shared by all groups
                            contextMenu: nodeContextMenu
                        }
                        ));
                //Menu contextuel appartenant au diagramme lui-meme
                myDiagram.contextMenu =
                        GOMAKE(go.Adornment, "Vertical",
                                makeButton("Coller",
                                        function (e, obj) {
                                            e.diagram.commandHandler.pasteSelection(e.diagram.lastInput.documentPoint);
                                        },
                                        function (o) {
                                            return o.diagram.commandHandler.canPasteSelection();
                                        }),
                                makeButton("Annuler",
                                        function (e, obj) {
                                            e.diagram.commandHandler.undo();
                                        },
                                        function (o) {
                                            return o.diagram.commandHandler.canUndo();
                                        }),
                                makeButton("Refaire",
                                        function (e, obj) {
                                            e.diagram.commandHandler.redo();
                                        },
                                        function (o) {
                                            return o.diagram.commandHandler.canRedo();
                                        }),
                                makeButton("Construire Argument",
                                        function (e, obj) {
                                            createArgument(obj, obj.diagram.selection);
                                        },
                                        function (o) {
                                            return o.diagram.selection.count >= 1;
                                        }),
                                makeButton("Plein écran",
                                        function (e, obj) {
                                            getreqfullscreen().call(document.getElementById("myDiagramDiv"));
                                        },
                                        function (o) {
                                            return true;
                                        }));

                // Creer un editeur de text avec les symboles logiques
                var customEditor = GOMAKE(go.HTMLInfo);
                var customInput = document.createElement("input");
                customInput.setAttribute("class", "form-control");
                customInput.id = "textinput";
                var customEditorDiv = setupLogicKeyboard(customInput);

                customEditorDiv.appendChild(document.createElement("br"));
                customEditorDiv.appendChild(customInput);

                customEditor.show = function (textBlock, diagram, tool) {
                    if (!(textBlock instanceof go.TextBlock))
                        return;
                    customInput.innerHTML = "";
                    customInput.value = textBlock.text;


                    // Do a few different things when a user presses a key
                    customInput.onkeypress = function (e) {

                        var keynum = e.which;
                        if (keynum === 13) { // Accept on Enter
                            tool.doMouseDown();

                            return;
                        } else if (keynum === 27) { // Cancel on Esc
                            tool.doCancel();
                            if (tool.diagram)
                                tool.diagram.focus();
                        }
                    };

                    var loc = textBlock.getDocumentPoint(go.Spot.TopLeft);
                    var pos = diagram.transformDocToView(loc);
                    customEditorDiv.style.left = pos.x + "px";
                    customEditorDiv.style.top = pos.y + "px";
                    customEditorDiv.style.position = 'absolute';
                    customEditorDiv.style.zIndex = 100; // place it in front of the Diagram

                    diagram.div.appendChild(customEditorDiv);
                };

                customEditor.hide = function (diagram, tool) {
                    diagram.div.removeChild(customEditorDiv);
                };

                // This is necessary for HTMLInfo instances that are used as text editors
                customEditor.valueFunction = function () {
                    return customInput.value;
                };

                // when the document is modified, add a "*" to the title and enable the "Save" button
                myDiagram.addDiagramListener("Modified", function (e) {
                    var button = document.getElementById("SaveButton");
                    if (button)
                        button.disabled = !myDiagram.isModified;
                    button = document.getElementById("ExportButton");
                    if (button)
                        button.disabled = !myDiagram.isModified;
                    var idx = document.title.indexOf("*");
                    if (myDiagram.isModified) {
                        if (idx < 0)
                            document.title += "*";
                    } else {
                        if (idx >= 0)
                            document.title = document.title.substr(0, idx);
                    }
                });
                // Set the HTMLInfo:
                myDiagram.toolManager.textEditingTool.defaultTextEditor = customEditor;

                document.getElementById('files').addEventListener('change', handleFileSelect, false);
                //importfromjson();
                document.getElementById("clavierlogique").appendChild(setupLogicKeyboard(document.getElementById("premisses")));
            }
            function setupLogicKeyboard(customInput) {
                var customEditorDiv = document.createElement("div");
                var customLKETbutton = document.createElement("button");
                var customLKOUbutton = document.createElement("button");
                var customLKNEGbutton = document.createElement("button");
                var customLKEQUIVbutton = document.createElement("button");
                var customLKIMPLICbutton = document.createElement("button");
                var customLKCONTRAbutton = document.createElement("button");
                var customLKEXISTbutton = document.createElement("button");
                var customLKNEXISTbutton = document.createElement("button");
                var customLKPTOUTbutton = document.createElement("button");
                var customLKET = "∧";
                var customLKOU = "∨";
                var customLKNEG = "∼";
                var customLKEQUIV = "≡";
                var customLKIMPLIC = "⊃";
                var customLKCONTRA = "⊥";
                var customLKEXIST = "∃";
                var customLKNEXIST = "∄";
                var customLKPTOUT = "∀";
                customEditorDiv.appendChild(customLKETbutton);
                customEditorDiv.appendChild(customLKOUbutton);
                customEditorDiv.appendChild(customLKNEGbutton);
                customEditorDiv.appendChild(customLKEQUIVbutton);
                customEditorDiv.appendChild(customLKIMPLICbutton);
                customEditorDiv.appendChild(customLKCONTRAbutton);
                customEditorDiv.appendChild(customLKEXISTbutton);
                customEditorDiv.appendChild(customLKNEXISTbutton);
                customEditorDiv.appendChild(customLKPTOUTbutton);

                customLKETbutton.innerHTML = customLKET;
                customLKOUbutton.innerHTML = customLKOU;
                customLKNEGbutton.innerHTML = customLKNEG;
                customLKEQUIVbutton.innerHTML = customLKEQUIV;
                customLKIMPLICbutton.innerHTML = customLKIMPLIC;
                customLKCONTRAbutton.innerHTML = customLKCONTRA;
                customLKEXISTbutton.innerHTML = customLKEXIST;
                customLKNEXISTbutton.innerHTML = customLKNEXIST;
                customLKPTOUTbutton.innerHTML = customLKPTOUT;

                customLKETbutton.setAttribute("class", "btn btn-light");
                customLKOUbutton.setAttribute("class", "btn btn-light");
                customLKNEGbutton.setAttribute("class", "btn btn-light");
                customLKEQUIVbutton.setAttribute("class", "btn btn-light");
                customLKIMPLICbutton.setAttribute("class", "btn btn-light");
                customLKCONTRAbutton.setAttribute("class", "btn btn-light");
                customLKEXISTbutton.setAttribute("class", "btn btn-light");
                customLKNEXISTbutton.setAttribute("class", "btn btn-light");
                customLKPTOUTbutton.setAttribute("class", "btn btn-light");
                customLKETbutton.setAttribute("type", "button");
                customLKOUbutton.setAttribute("type", "button");
                customLKNEGbutton.setAttribute("type", "button");
                customLKEQUIVbutton.setAttribute("type", "button");
                customLKIMPLICbutton.setAttribute("type", "button");
                customLKCONTRAbutton.setAttribute("type", "button");
                customLKEXISTbutton.setAttribute("type", "button");
                customLKNEXISTbutton.setAttribute("type", "button");
                customLKPTOUTbutton.setAttribute("type", "button");

                customLKETbutton.onclick = function () {
                    customInput.value += customLKETbutton.innerHTML;
                    customInput.focus();
                };
                customLKOUbutton.onclick = function () {
                    customInput.value += customLKOUbutton.innerHTML;
                    customInput.focus();
                };
                customLKNEGbutton.onclick = function () {
                    customInput.value += customLKNEGbutton.innerHTML;
                    customInput.focus();
                };
                customLKEQUIVbutton.onclick = function () {
                    customInput.value += customLKEQUIVbutton.innerHTML;
                    customInput.focus();
                };
                customLKIMPLICbutton.onclick = function () {
                    customInput.value += customLKIMPLICbutton.innerHTML;
                    customInput.focus();
                };
                customLKCONTRAbutton.onclick = function () {
                    customInput.value += customLKCONTRAbutton.innerHTML;
                    customInput.focus();
                };
                customLKEXISTbutton.onclick = function () {
                    customInput.value += customLKEXISTbutton.innerHTML;
                    customInput.focus();
                };
                customLKNEXISTbutton.onclick = function () {
                    customInput.value += customLKNEXISTbutton.innerHTML;
                    customInput.focus();
                };
                customLKPTOUTbutton.onclick = function () {
                    customInput.value += customLKPTOUTbutton.innerHTML;
                    customInput.focus();
                };

                return customEditorDiv;
            }

            // Show the diagram's model in JSON format
            function exporttojson() {
                document.getElementById("mySavedModel").value = myDiagram.model.toJson();
                myDiagram.isModified = false;
            }

            function importfromjson() {
                myDiagram.model = go.Model.fromJson(document.getElementById("mySavedModel").value);
            }

            function download(text, name, type) {
                var a = document.createElement("a");
                var file = new Blob([text], {
                    type: type
                });
                a.href = URL.createObjectURL(file);
                a.download = name;
                a.click();
            }

            function savetofile() {
                download(myDiagram.model.toJson(), 'organon.json', 'text/plain');

            }

            function handleFileSelect(evt) {
                var f = evt.target.files[0]; // FileList object

                // files is a FileList of File objects. List some properties.
                var reader = new FileReader();
                // Closure to capture the file information.
                reader.onload = (function (theFile) {
                    return function (e) {
                        myDiagram.model = go.Model.fromJson(e.target.result);
                    };
                })(f);
                reader.readAsText(f);
            }
            function ajouterPremisses() {
                var deltaX = myDiagram.position.x;
                var deltaY = myDiagram.position.y;
                myDiagram.startTransaction("Ajout de premisses");

                premisses = document.getElementById("premisses").value.split("\n");
                if (premisses.length >= 1) {
                    for (var i = 0; i < premisses.length; i++) {
                        //if (i === 0)
                        //    myDiagram.selectCollection(myDiagram.nodes);
                        if (premisses[i].trim().length >= 1) {
                            myDiagram.model.addNodeData({
                                text: premisses[i].trim(),
                                loc: spiralLoc(i, deltaX, deltaY)
                            });
                        }
                    }
                }
                myDiagram.commitTransaction("Ajout de premisses");
                myDiagram.clearSelection();
                myDiagram.zoomToRect(myDiagram.documentBounds);
                myDiagram.centerRect(myDiagram.documentBounds);
            }
            function spiralLoc(i, deltaX, deltaY) {
                var a = 30;
                var n = 1;
                var x = a * Math.pow(i, 1 / n) * Math.cos(i) + deltaX;
                var y = a * Math.pow(i, 1 / n) * Math.sin(i) + deltaY;
                return x.toString() + " " + y.toString();
            }
            function getreqfullscreen() {
                var isInFullScreen = (document.fullscreenElement && document.fullscreenElement !== null) ||
                        (document.webkitFullscreenElement && document.webkitFullscreenElement !== null) ||
                        (document.mozFullScreenElement && document.mozFullScreenElement !== null) ||
                        (document.msFullscreenElement && document.msFullscreenElement !== null);
                if (!isInFullScreen) {
                    var root = document.documentElement;
                    return root.requestFullscreen || root.webkitRequestFullscreen || root.mozRequestFullScreen || root.msRequestFullscreen;
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                    myDiagram.currentTool.doCancel() 
                }
            }
            //usage: getreqfullscreen().call(targetelement) // open full screen on targetelement
            $(function () {
                $("#boitepremisses").draggable({handle: "#handle"});
            });
        </script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

        <style>
            #myDiagramDiv{
                border: solid 1px black;
                width:100%;
                height:600px;
            }
            #myDiagramDiv:-webkit-full-screen {
                /*style for full screen element */
                border: solid 1px black;
                width:100%;
                height:100%;
            }

            #myDiagramDiv:-moz-full-screen {
                /*style for full screen element */
                border: solid 1px black;
                width:100%;
                height:100%;
            }

            #myDiagramDiv:-ms-fullscreen {
                /*style for full screen element */
                border: solid 1px black;
                width:100%;
                height:100%;
            }

            #myDiagramDiv:fullscreen { /* official selector */
                /*style for full screen element */
                border: solid 1px black;
                width:100%;
                height:100%;
            }
            #boitepremisses {
                z-index: 2000;
                position: absolute;
                top: 0px;
                left: 0px;
            }
            #pleinecran {
                z-index: 2000;
                position: absolute;
                top:0px;
                right:0px;
            }
        </style>
    </head>

    <body onload="init()">
        <!--        <h1>Visualisation de logique</h1>-->

        <div class="container-fluid">
            <div id="myDiagramDiv"></div>

            <div>
                <div>
                    <button id="SaveButton" onclick="savetofile()">Télécharger</button>
                    <input type="file" id="files" name="file" />
                </div>
                <!--                <div>
                                    <button id="ExportButton" onclick="exporttojson()">Exporter</button>
                                    <button onclick="importfromjson()">Importer</button> Diagram.model en format JSON:<br />
                                </div>
                
                                <textarea id="mySavedModel" style="width:100%;height:400px">
                
                                </textarea>-->
            </div>
        </div>

        <div>

            <div class="card" id="boitepremisses">
                <div class="card-header" id="handle">
                    <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#boitentree" aria-expanded="false" aria-controls="collapseExample">
                        Boîte d'entrée
                    </button>

                </div>
                <div class="collapse" id="boitentree">

                    <div class="card-body">
                        <div id="clavierlogique">
                            <button type="button" class="btn btn-primary" id="ajoutPremisses" onclick="ajouterPremisses()">Ajouter les prémisses</button>
                        </div>
                        <textarea id ="premisses" style="height:150px;width:100%;">
Test1
Test2
Test3
Test4
Test5
Test6
Test7
Test8
Test9
Test10
Test11
Test12
Test13
Test14
Test15</textarea>
                    </div>
                </div>
            </div>
        </div>
    </body>

</html>