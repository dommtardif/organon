<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Organon</title>
    <meta name="description" content="Visualisateur de logique" />
    <!-- Copyright 1998-2018 by Northwoods Software Corporation. -->
    <meta charset="UTF-8">
    <script src="./release/go.js"></script>
    <script id="code">
// This variation on ForceDirectedLayout does not move any selected Nodes
  // but does move all other nodes (vertexes).
  function ContinuousForceDirectedLayout() {
    go.ForceDirectedLayout.call(this);
    this._isObserving = false;
  }
  go.Diagram.inherit(ContinuousForceDirectedLayout, go.ForceDirectedLayout);

  /** @override */
  ContinuousForceDirectedLayout.prototype.isFixed = function(v) {
    return v.node.isSelected;
  }

  // optimization: reuse the ForceDirectedNetwork rather than re-create it each time
  /** @override */
  ContinuousForceDirectedLayout.prototype.doLayout = function(coll) {
    if (!this._isObserving) {
      this._isObserving = true;
      // cacheing the network means we need to recreate it if nodes or links have been added or removed or relinked,
      // so we need to track structural model changes to discard the saved network.
      var lay = this;
      this.diagram.addModelChangedListener(function (e) {
        // modelChanges include a few cases that we don't actually care about, such as
        // "nodeCategory" or "linkToPortId", but we'll go ahead and recreate the network anyway.
        // Also clear the network when replacing the model.
        if (e.modelChange !== "" ||
            (e.change === go.ChangedEvent.Transaction && e.propertyName === "StartingFirstTransaction")) {
          lay.network = null;
        }
      });
    }
    var net = this.network;
    if (net === null) {  // the first time, just create the network as normal
      this.network = net = this.makeNetwork(coll);
    } else {  // but on reuse we need to update the LayoutVertex.bounds for selected nodes
      this.diagram.nodes.each(function (n) {
        var v = net.findVertex(n);
        if (v !== null) v.bounds = n.actualBounds;
      });
    }
    // now perform the normal layout
    go.ForceDirectedLayout.prototype.doLayout.call(this, coll);
    // doLayout normally discards the LayoutNetwork by setting Layout.network to null;
    // here we remember it for next time
    this.network = net;
  }
  // end ContinuousForceDirectedLayout
        function init() {
            //if (window.goSamples) goSamples();  // init for these samples -- you don't need to call this
            var $ = go.GraphObject.make;

            myDiagram =
                $(go.Diagram, "myDiagramDiv", // create a Diagram for the DIV HTML element
                    {
                        initialContentAlignment: go.Spot.Center,
                        //layout: new go.ForceDirectedLayout(),
                        layout:
                        $(ContinuousForceDirectedLayout,  // automatically spread nodes apart while dragging
                              { defaultSpringLength: 30, defaultElectricalCharge: 100 }),
                          // do an extra layout at the end of a move
                        "SelectionMoved": function(e) { e.diagram.layout.invalidateLayout(); },
                        //"LinkDrawn": maybeChangeLinkCategory, // these two DiagramEvents call a
                        //"LinkRelinked": maybeChangeLinkCategory, // function that is defined below
                        // allow double-click in background to create a new node
                        "clickCreatingTool.archetypeNodeData": {
                            text: "Énoncé",
                            color: "gold"
                        },

                        // allow Ctrl-G to call groupSelection()
                        "commandHandler.archetypeGroupData": {
                            text: "Groupe",
                            isGroup: true,
                            color: "blue"
                        },
                        // have mouse wheel events zoom in and out instead of scroll up and down
                        "toolManager.mouseWheelBehavior": go.ToolManager.WheelZoom,
                        // enable undo & redo
                        "undoManager.isEnabled": true
                    });
            var lay = myDiagram.layout;
            lay.maxIterations = 100;
            lay.epsilon = 1;
            lay.infinity = 1000;
            var arrangementSpacing = new go.Size();
            arrangementSpacing.width = 10;
            arrangementSpacing.height = 10;
            lay.arrangementSpacing = arrangementSpacing;
            lay.defaultElectricalCharge = 50;
            lay.defaultGravitationalMass = 20;
            lay.defaultSpringStiffness = 0.05;
            lay.defaultSpringLength = 20;
            lay.comments = true;
            // First, define the shared context menu for all Nodes, Links, and Groups.

            // To simplify this code we define a function for creating a context menu button:
            function makeButton(text, action, visiblePredicate) {
                return $("ContextMenuButton",
                    $(go.TextBlock, text), {
                        click: action
                    },
                    // don't bother with binding GraphObject.visible if there's no predicate
                    visiblePredicate ? new go.Binding("visible", "", function(o, e) {
                        return o.diagram ? visiblePredicate(o, e) : false;
                    }).ofObject() : {});
            }

            function changeNodeBackground(obj, color) {
                var contextmenu = obj.part; // the Button is in the context menu Adornment
                var part = contextmenu.adornedPart; // the adornedPart is the Part that the context menu adorns
                // now can do something with PART, or with its data, or with the Adornment (the context menu)
                if (part instanceof go.Node) {
                    var shape = part.findObject("SHAPE");
                    shape.fill = color;
                }
            }
            // a context menu is an Adornment with a bunch of buttons in them
            var nodeContextMenu =
                $(go.Adornment, "Vertical",
                    makeButton("Propriétés",
                        function(e, obj) { // OBJ is this Button
                            var contextmenu = obj.part; // the Button is in the context menu Adornment
                            var part = contextmenu.adornedPart; // the adornedPart is the Part that the context menu adorns
                            // now can do something with PART, or with its data, or with the Adornment (the context menu)
                            if (part instanceof go.Link) alert(linkInfo(part.data));
                            else if (part instanceof go.Group) alert(groupInfo(contextmenu));
                            else alert(nodeInfo(part.data));
                        }),
                    makeButton("Conclusion",
                        function(e, obj) { // OBJ is this Button
                            var contextmenu = obj.part; // the Button is in the context menu Adornment
                            var part = contextmenu.adornedPart; // the adornedPart is the Part that the context menu adorns
                            // now can do something with PART, or with its data, or with the Adornment (the context menu)
                            if (part instanceof go.Node) {
                                if (part.data.conclusion) {
                                    changeNodeBackground(obj, "gold");
                                    part.data.conclusion = false
                                } else if (!part.data.conclusion) {
                                    changeNodeBackground(obj, "blue");
                                    part.data.conclusion = true
                                } else alert("Erreur")
                            }
                        }),
                    makeButton("Niveau 1", function(e, obj) {
                        changeNodeBackground(obj, "gold")
                    }),
                    makeButton("Niveau 2", function(e, obj) {
                        changeNodeBackground(obj, "tomato")
                    }),
                    makeButton("Niveau 3", function(e, obj) {
                        changeNodeBackground(obj, "mediumslateblue")
                    }),
                    makeButton("Niveau 4", function(e, obj) {
                        changeNodeBackground(obj, "lightslategray")
                    }),
                    makeButton("Niveau 5", function(e, obj) {
                        changeNodeBackground(obj, "mediumaquamarine")
                    }),

                    makeButton("Couper",
                        function(e, obj) {
                            e.diagram.commandHandler.cutSelection();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canCutSelection();
                        }),
                    makeButton("Copier",
                        function(e, obj) {
                            e.diagram.commandHandler.copySelection();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canCopySelection();
                        }),
                    makeButton("Coller",
                        function(e, obj) {
                            e.diagram.commandHandler.pasteSelection(e.diagram.lastInput.documentPoint);
                        },
                        function(o) {
                            return o.diagram.commandHandler.canPasteSelection();
                        }),
                    makeButton("Supprimer",
                        function(e, obj) {
                            e.diagram.commandHandler.deleteSelection();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canDeleteSelection();
                        }),
                    makeButton("Annuler",
                        function(e, obj) {
                            e.diagram.commandHandler.undo();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canUndo();
                        }),
                    makeButton("Refaire",
                        function(e, obj) {
                            e.diagram.commandHandler.redo();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canRedo();
                        }),
                    makeButton("Grouper",
                        function(e, obj) {
                            e.diagram.commandHandler.groupSelection();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canGroupSelection();
                        }),
                    makeButton("Dégrouper",
                        function(e, obj) {
                            e.diagram.commandHandler.ungroupSelection();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canUngroupSelection();
                        }),
                   /* makeButton("Dégrouper",
                        function(e, obj) {
                            var partlist = new go.List(go.Part);
                            var contextmenu = obj.part; // the Button is in the context menu Adornment
                            var part = contextmenu.adornedPart; // the adornedPart is the Part that the context menu adorns
                            partlist.add(part);
                            // now can do something with PART, or with its data, or with the Adornment (the context menu)
                            e.diagram.commandHandler.addTopLevelParts(partlist,true);
                        },
                        function(o) {
                            alert(o.diagramHandler.isValidMember(null,o.part))
                            var part = o.part; // the adornedPart is the Part that the context menu adorns
                            // now can do something with PART, or with its data, or with the Adornment (the context menu)
                            //return (part instanceof go.Node) && o.diagramHandler.isValidMember(null,part) && part.data.hasOwnProperty("group")
                            return false
                        }),
                    */
                    makeButton("Construire Argument",
                        function(e, obj) {
                            createArgument(obj, obj.diagram.selection);
                        },
                        function(o) {
                            //alert(o.diagram.selection.count);
                            return o.diagram.selection.count >= 1;
                        })
                    
                    
                );
            var partContextMenu =
                $(go.Adornment, "Vertical",
                    makeButton("Propriétés",
                        function(e, obj) { // OBJ is this Button
                            var contextmenu = obj.part; // the Button is in the context menu Adornment
                            var part = contextmenu.adornedPart; // the adornedPart is the Part that the context menu adorns
                            // now can do something with PART, or with its data, or with the Adornment (the context menu)
                            if (part instanceof go.Link) alert(linkInfo(part.data));
                            else if (part instanceof go.Group) alert(groupInfo(contextmenu));
                            else alert(nodeInfo(part.data));
                        }),
                    makeButton("Couper",
                        function(e, obj) {
                            e.diagram.commandHandler.cutSelection();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canCutSelection();
                        }),
                    makeButton("Copier",
                        function(e, obj) {
                            e.diagram.commandHandler.copySelection();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canCopySelection();
                        }),
                    makeButton("Coller",
                        function(e, obj) {
                            e.diagram.commandHandler.pasteSelection(e.diagram.lastInput.documentPoint);
                        },
                        function(o) {
                            return o.diagram.commandHandler.canPasteSelection();
                        }),
                    makeButton("Supprimer",
                        function(e, obj) {
                            e.diagram.commandHandler.deleteSelection();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canDeleteSelection();
                        }),
                    makeButton("Annuler",
                        function(e, obj) {
                            e.diagram.commandHandler.undo();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canUndo();
                        }),
                    makeButton("Refaire",
                        function(e, obj) {
                            e.diagram.commandHandler.redo();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canRedo();
                        }),
                    makeButton("Grouper",
                        function(e, obj) {
                            e.diagram.commandHandler.groupSelection();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canGroupSelection();
                        }),
                    makeButton("Dégrouper",
                        function(e, obj) {
                            e.diagram.commandHandler.ungroupSelection();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canUngroupSelection();
                        })
                );
            //Functions to display info for different parts
            function groupInfo(adornment) { // takes the tooltip or context menu, not a group node data object
                var g = adornment.adornedPart; // get the Group that the tooltip adorns
                var mems = g.memberParts.count;
                var links = 0;
                g.memberParts.each(function(part) {
                    if (part instanceof go.Link) links++;
                });
                return "Group " + g.data.key + ": " + g.data.text + "\n" + mems + " members including " + links + " links";
            }

            function nodeInfo(d) { // Tooltip info for a node data object
                var str = "Node " + d.key + ": " + d.text + "\n";
                if (d.group)
                    str += "member of " + d.group;
                else
                    str += "top-level node";
                return str;
            }

            function linkInfo(d) { // Tooltip info for a link data object
                return "Link:\nfrom " + d.from + " to " + d.to;
            }
            // when the document is modified, add a "*" to the title and enable the "Save" button
            myDiagram.addDiagramListener("Modified", function(e) {
                var button = document.getElementById("SaveButton");
                if (button) button.disabled = !myDiagram.isModified;
                button = document.getElementById("ExportButton");
                if (button) button.disabled = !myDiagram.isModified;
                var idx = document.title.indexOf("*");
                if (myDiagram.isModified) {
                    if (idx < 0) document.title += "*";
                } else {
                    if (idx >= 0) document.title = document.title.substr(0, idx);
                }
            });




            // define the Node template
            myDiagram.nodeTemplate =
                $(go.Node, "Auto",
                    new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
                    new go.Binding("visible", "visible").makeTwoWay(),
                    new go.Binding("conclusion", "conclusion", Boolean).makeTwoWay(),
                    // define the node's outer shape, which will surround the TextBlock
                    $(go.Shape, "RoundedRectangle", {
                            parameter1: 20, // the corner has a large radius
                            fill: "gold",
                            stroke: null,
                            portId: "", // this Shape is the Node's port, not the whole Node
                            fromLinkable: true,
                            fromLinkableSelfNode: true,
                            fromLinkableDuplicates: true,
                            toLinkable: true,
                            toLinkableSelfNode: true,
                            toLinkableDuplicates: true,
                            cursor: "pointer",
                            name: "SHAPE"
                        },
                        new go.Binding("fill", "color").makeTwoWay()
                    ),
                    $(go.Panel, "Vertical",
                        $(go.TextBlock, {
                                font: "bold 11pt helvetica, bold arial, sans-serif",
                                editable: true // editing the text automatically updates the model data
                            },
                            new go.Binding("text").makeTwoWay()
                        ),
                        $("TreeExpanderButton")
                    ), {
                        // the same context menu Adornment is shared by all groups
                        contextMenu: nodeContextMenu
                    }
                );

            // unlike the normal selection Adornment, this one includes a Button
            myDiagram.nodeTemplate.selectionAdornmentTemplate =
                $(go.Adornment, "Spot",
                    $(go.Panel, "Auto",
                        $(go.Shape, {
                            fill: null,
                            stroke: "blue",
                            strokeWidth: 2
                        }),
                        $(go.Placeholder) // a Placeholder sizes itself to the selected Node
                    ),

                    // the button to create a "next" node, at the top-right corner
                    $("Button",
                      {
                        alignment: go.Spot.TopRight,
                        click: addNodeToRight  // this function is defined below
                      },
                      $(go.Shape, "PlusLine", { width: 6, height: 6 })
                    ) // end button
                ); // end Adornment

            function createArgument(e,selection){
                var diagram = e.diagram;
                var selArray = new Array();
                var group = {isGroup: true, text: "Argument"};
                diagram.model.makeNodeDataKeyUnique(group);
                var premisse = selection.iterator;
                  while (premisse.next()) {
                    selArray.push(premisse.value);
                  }
                
                if (selArray.length > 1) var conclusion = selArray.pop();
                else var conclusion = selArray[0];
                var cdata = conclusion.data;
               
                diagram.startTransaction("Create argument");
                  for (var i = 0; i < selArray.length; i++) {
                    diagram.model.addLinkData({ from: diagram.model.getKeyForNodeData(selArray[i]), to: diagram.model.getKeyForNodeData(cdata) }); 
                  }
                diagram.select(conclusion);
                diagram.commitTransaction("Create argument");
                diagram.layout.invalidateLayout();
                diagram.startTransaction("Create group around argument"); 
                diagram.model.addNodeData(group);

                diagram.model.setGroupKeyForNodeData(conclusion.data,diagram.model.getKeyForNodeData(group));

                  for (var i = 0; i < selArray.length; i++) {
                    diagram.model.setGroupKeyForNodeData(selArray[i].data,diagram.model.getKeyForNodeData(group));                    
                  }
                diagram.commitTransaction("Create group around argument");
            }
            function addNodeToRight(e, obj) {
                var adornment = obj.part;
                var diagram = e.diagram;
                diagram.startTransaction("Add State");

                // get the node data for which the user clicked the button
                var fromNode = adornment.adornedPart;
                var fromData = fromNode.data;
                // create a new "State" data object, positioned off to the right of the adorned Node
                var toData = {
                    text: "Énoncé",
                    color: fromNode.data.color
                };
                if (fromData.hasOwnProperty("group")){
                    toData.group = fromData.group
                }
                var p = fromNode.location.copy();
                p.x += 100;
                toData.loc = go.Point.stringify(p); // the "loc" property is a string, not a Point object
                // add the new node data to the model
                var model = diagram.model;
                model.addNodeData(toData);

                // select the new Node
                var newnode = diagram.findNodeForData(toData);
                diagram.select(newnode);

                diagram.commitTransaction("Add State");

                // if the new node is off-screen, scroll the diagram to show the new node
                diagram.scrollToRect(newnode.actualBounds);
            }

            // This is the template for a label node on a link: just an Ellipse.
            // This node supports user-drawn links to and from the label node.
            /*myDiagram.nodeTemplateMap.add("LinkLabel",
              $("Node", {
                        selectable: false,
                        avoidable: true,
                        layerName: "Foreground",
                        isLayoutPositioned: true 

                    }, // always have link label nodes in front of Links
                    new go.Binding("visible", "visible").makeTwoWay(),
                    $("Shape", "Ellipse", {
                        width: 5,
                        height: 5,
                        stroke: null,
                        portId: "",
                        fromLinkable: true,
                        toLinkable: true,
                        cursor: "pointer"
                    })
                )
            
                );
*/            
            // the regular link template, a straight blue arrow
           myDiagram.linkTemplate =
                $("Link", // the whole link panel
                    {
                        curve: go.Link.JumpGap,
                        adjusting: go.Link.Stretch,
                        corner: 15,
                        reshapable: true,
                        relinkableFrom: true,
                        relinkableTo: true,
                        toShortLength: 3,
                        routing: go.Link.AvoidsNodes
                    },
                    new go.Binding("points").makeTwoWay(),
                    new go.Binding("curviness"),
                    $(go.Shape, // the link shape
                        {
                            strokeWidth: 1.5
                        }),
                    $(go.Shape, // the arrowhead
                        {
                            toArrow: "standard",
                            stroke: null
                        }),
                    $(go.Panel, "Auto",
                        $(go.TextBlock, "transition", // the label text
                            {
                                textAlign: "center",
                                font: "9pt helvetica, arial, sans-serif",
                                margin: 4,
                                editable: true // enable in-place editing
                            },
                            // editing the text automatically updates the model data
                            new go.Binding("text").makeTwoWay())
                    ), {
                        // the same context menu Adornment is shared by all groups
                        contextMenu: partContextMenu
                    }
                );
            
            // This template shows links connecting with label nodes as green and arrow-less.
/*            myDiagram.linkTemplateMap.add("linkToLink",
                $("Link", // the whole link panel
                    {
                        curve: go.Link.JumpGap,
                        adjusting: go.Link.Stretch,
                        isLayoutPositioned: true,
                        corner: 15,
                        reshapable: true,
                        relinkableFrom: true,
                        relinkableTo: true,
                        toShortLength: 3,
                        routing: go.Link.AvoidsNodes
                    },
                    new go.Binding("points").makeTwoWay(),
                    new go.Binding("curviness"),
                    $(go.Shape, // the link shape
                        {
                            strokeWidth: 1.5
                        }), {
                        // the same context menu Adornment is shared by all groups
                        contextMenu: partContextMenu
                    }

                )
            
                );
                */
            myDiagram.groupTemplate =
                $(go.Group, "Vertical", {
                        selectionObjectName: "PANEL", // selection handle goes around shape, not label
                        ungroupable: true,
                        fromSpot: go.Spot.Bottom, // coming out from middle-right
                        toSpot: go.Spot.Top
                    }, // enable Ctrl-Shift-G to ungroup a selected Group
                    $(go.Panel, "Horizontal",
                        $(go.TextBlock, {
                                font: "bold 19px sans-serif",
                                isMultiline: false, // don't allow newlines in text
                                editable: true // allow in-place editing by user
                            },
                            new go.Binding("text", "text").makeTwoWay(),
                            new go.Binding("stroke", "color")),
                        $("SubGraphExpanderButton"),
                        $("TreeExpanderButton")
                    ),
                    $(go.Panel, "Auto", {
                            name: "PANEL"
                        },
                        $(go.Shape, "RoundedRectangle", // the rectangular shape around the members
                            {
                                parameter1: 15,
                                fill: "rgba(128,128,128,0.2)",
                                stroke: "gray",
                                strokeWidth: 3,
                                portId: "",
                                cursor: "pointer", // the Shape is the port, not the whole Node
                                // allow all kinds of links from and to this port
                                fromLinkable: true,
                                fromLinkableSelfNode: true,
                                fromLinkableDuplicates: true,
                                toLinkable: true,
                                toLinkableSelfNode: true,
                                toLinkableDuplicates: true
                            }),
                        $(go.Placeholder, {
                            margin: 10,
                            background: "transparent"
                        }) // represents where the members are
                    ), {
                        // the same context menu Adornment is shared by all groups
                        contextMenu: partContextMenu
                    }
                );

            // GraphLinksModel support for link label nodes requires specifying two properties.
           // myDiagram.model =
            //    $(go.GraphLinksModel, {
            //        linkLabelKeysProperty: "labelKeys"
            //    });

            // Whenever a new Link is drawng by the LinkingTool, it also adds a node data object
            // that acts as the label node for the link, to allow links to be drawn to/from the link.
            //myDiagram.toolManager.linkingTool.archetypeLabelNodeData = {
            //    category: "LinkLabel"
            //};

            // this DiagramEvent handler is called during the linking or relinking transactions
            //function maybeChangeLinkCategory(e) {
            //    var link = e.subject;
            //    var linktolink = (link.fromNode.isLinkLabel || link.toNode.isLinkLabel);

             //   e.diagram.model.setCategoryForLinkData(link.data, (linktolink ? "linkToLink" : ""));
           // }
            // provide a context menu for the background of the Diagram, when not over any Part
            myDiagram.contextMenu =
                $(go.Adornment, "Vertical",
                    makeButton("Coller",
                        function(e, obj) {
                            e.diagram.commandHandler.pasteSelection(e.diagram.lastInput.documentPoint);
                        },
                        function(o) {
                            return o.diagram.commandHandler.canPasteSelection();
                        }),
                    makeButton("Annuler",
                        function(e, obj) {
                            e.diagram.commandHandler.undo();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canUndo();
                        }),
                    makeButton("Refaire",
                        function(e, obj) {
                            e.diagram.commandHandler.redo();
                        },
                        function(o) {
                            return o.diagram.commandHandler.canRedo();
                        }),
                    makeButton("Construire Argument",
                        function(e, obj) {
                            createArgument(obj, obj.diagram.selection);
                        },
                        function(o) {
                            return o.diagram.selection.count >= 1
                        })
                );
            
                // Create an HTMLInfo and dynamically create some HTML to show/hide
                var customEditor = new go.HTMLInfo();
                var customEditorDiv  = document.createElement("div")
                var customInput = document.createElement("input");
                var customLKETbutton = document.createElement("button");
                var customLKOUbutton = document.createElement("button");
                var customLKNEGbutton = document.createElement("button");
                var customLKEQUIVbutton = document.createElement("button");
                var customLKIMPLICbutton = document.createElement("button");
                var customLKCONTRAbutton = document.createElement("button");
                var customLKEXISTbutton = document.createElement("button");
                var customLKNEXISTbutton = document.createElement("button");
                var customLKPTOUTbutton = document.createElement("button");
                var customLKET = "∧"
                var customLKOU = "∨"
                var customLKNEG = "∼"
                var customLKEQUIV = "≡"
                var customLKIMPLIC = "⊃"
                var customLKCONTRA = "⊥"
                var customLKEXIST = "∃"
                var customLKNEXIST= "∄"
                var customLKPTOUT = "∀"
                  customEditorDiv.appendChild(customLKETbutton)
                  customEditorDiv.appendChild(customLKOUbutton)
                  customEditorDiv.appendChild(customLKNEGbutton)
                  customEditorDiv.appendChild(customLKEQUIVbutton)
                  customEditorDiv.appendChild(customLKIMPLICbutton)
                  customEditorDiv.appendChild(customLKCONTRAbutton)
                  customEditorDiv.appendChild(customLKEXISTbutton)
                  customEditorDiv.appendChild(customLKNEXISTbutton)
                  customEditorDiv.appendChild(customLKPTOUTbutton)
                  customEditorDiv.appendChild(document.createElement("br"))
                  customEditorDiv.appendChild(customInput)
                
                customEditor.show = function(textBlock, diagram, tool) {
                    if (!(textBlock instanceof go.TextBlock)) return;
                   
                    customLKETbutton.innerHTML = customLKET;
                    customLKOUbutton.innerHTML = customLKOU
                    customLKNEGbutton.innerHTML = customLKNEG
                    customLKEQUIVbutton.innerHTML = customLKEQUIV
                    customLKIMPLICbutton.innerHTML = customLKIMPLIC
                    customLKCONTRAbutton.innerHTML = customLKCONTRA
                    customLKEXISTbutton.innerHTML = customLKEXIST
                    customLKNEXISTbutton.innerHTML = customLKNEXIST
                    customLKPTOUTbutton.innerHTML = customLKPTOUT
                    customInput.innerHTML = "";
                    customInput.value = textBlock.text;
                    customInput.id = "textinput"
                    

                  // Do a few different things when a user presses a key
                  customInput.onkeypress = function(e){

                    var keynum = e.which;
                    console.log(keynum)
                    if (keynum == 13) { // Accept on Enter
                      console.log("key is enter");
                      tool.doMouseDown();

                      return;
                    } else if (keynum === 27) { // Cancel on Esc
                      tool.doCancel();
                      if (tool.diagram) tool.diagram.focus();
                    }
                  };
                  
                  customLKETbutton.onclick = function() {customInput.value += customLKETbutton.innerHTML}
                  customLKOUbutton.onclick = function() {customInput.value += customLKOUbutton.innerHTML}
                  customLKNEGbutton.onclick = function() {customInput.value += customLKNEGbutton.innerHTML}
                 customLKEQUIVbutton.onclick = function() {customInput.value += customLKEQUIVbutton.innerHTML}
                 customLKIMPLICbutton.onclick = function() {customInput.value += customLKIMPLICbutton.innerHTML}
                 customLKCONTRAbutton.onclick = function() {customInput.value += customLKCONTRAbutton.innerHTML}
                 customLKEXISTbutton.onclick = function() {customInput.value += customLKEXISTbutton.innerHTML}
                 customLKNEXISTbutton.onclick = function() {customInput.value += customLKNEXISTbutton.innerHTML}
                 customLKPTOUTbutton.onclick = function() {customInput.value += customLKPTOUTbutton.innerHTML}
                  var loc = textBlock.getDocumentPoint(go.Spot.TopLeft);
                  var pos = diagram.transformDocToView(loc);
                  customEditorDiv.style.left = pos.x + "px";
                  customEditorDiv.style.top  = pos.y + "px";
                  customEditorDiv.style.position = 'absolute';
                  customEditorDiv.style.zIndex = 100; // place it in front of the Diagram
                 
                  diagram.div.appendChild(customEditorDiv);
                }

                customEditor.hide = function(diagram, tool) {
                  diagram.div.removeChild(customEditorDiv);
                }

                // This is necessary for HTMLInfo instances that are used as text editors
                customEditor.valueFunction = function() { return customInput.value; }

                // Set the HTMLInfo:
                myDiagram.toolManager.textEditingTool.defaultTextEditor = customEditor;

            document.getElementById('files').addEventListener('change', handleFileSelect, false);
            //importfromjson();
    
                setupLogicKeyboard();
        }
                function setupLogicKeyboard(){   
                var customEditorDiv = document.createElement("div");
                var customLKETbutton = document.createElement("button");
                var customLKOUbutton = document.createElement("button");
                var customLKNEGbutton = document.createElement("button");
                var customLKEQUIVbutton = document.createElement("button");
                var customLKIMPLICbutton = document.createElement("button");
                var customLKCONTRAbutton = document.createElement("button");
                var customLKEXISTbutton = document.createElement("button");
                var customLKNEXISTbutton = document.createElement("button");
                var customLKPTOUTbutton = document.createElement("button");
                var customLKET = "∧";
                var customLKOU = "∨";
                var customLKNEG = "∼";
                var customLKEQUIV = "≡";
                var customLKIMPLIC = "⊃";
                var customLKCONTRA = "⊥";
                var customLKEXIST = "∃";
                var customLKNEXIST= "∄";
                var customLKPTOUT = "∀";
                  customEditorDiv.appendChild(customLKETbutton);
                  customEditorDiv.appendChild(customLKOUbutton);
                  customEditorDiv.appendChild(customLKNEGbutton);
                  customEditorDiv.appendChild(customLKEQUIVbutton);
                  customEditorDiv.appendChild(customLKIMPLICbutton);
                  customEditorDiv.appendChild(customLKCONTRAbutton);
                  customEditorDiv.appendChild(customLKEXISTbutton);
                  customEditorDiv.appendChild(customLKNEXISTbutton);
                  customEditorDiv.appendChild(customLKPTOUTbutton);
                   
                    customLKETbutton.innerHTML = customLKET;
                    customLKOUbutton.innerHTML = customLKOU;
                    customLKNEGbutton.innerHTML = customLKNEG;
                    customLKEQUIVbutton.innerHTML = customLKEQUIV;
                    customLKIMPLICbutton.innerHTML = customLKIMPLIC;
                    customLKCONTRAbutton.innerHTML = customLKCONTRA;
                    customLKEXISTbutton.innerHTML = customLKEXIST;
                    customLKNEXISTbutton.innerHTML = customLKNEXIST;
                    customLKPTOUTbutton.innerHTML = customLKPTOUT;
                customInput = document.getElementById("premisses");
                  
                  customLKETbutton.onclick = function() {customInput.value += customLKETbutton.innerHTML;customInput.focus();};
                  customLKOUbutton.onclick = function() {customInput.value += customLKOUbutton.innerHTML;customInput.focus();};
                  customLKNEGbutton.onclick = function() {customInput.value += customLKNEGbutton.innerHTML;customInput.focus();};
                 customLKEQUIVbutton.onclick = function() {customInput.value += customLKEQUIVbutton.innerHTML;customInput.focus();};
                 customLKIMPLICbutton.onclick = function() {customInput.value += customLKIMPLICbutton.innerHTML;customInput.focus();};
                 customLKCONTRAbutton.onclick = function() {customInput.value += customLKCONTRAbutton.innerHTML;customInput.focus();};
                 customLKEXISTbutton.onclick = function() {customInput.value += customLKEXISTbutton.innerHTML;customInput.focus();};
                 customLKNEXISTbutton.onclick = function() {customInput.value += customLKNEXISTbutton.innerHTML;customInput.focus();};
                 customLKPTOUTbutton.onclick = function() {customInput.value += customLKPTOUTbutton.innerHTML;customInput.focus();};
         
                 
                  document.getElementById("clavierlogique").appendChild(customEditorDiv);
                }

        // Show the diagram's model in JSON format
        function exporttojson() {
            document.getElementById("mySavedModel").value = myDiagram.model.toJson();
            myDiagram.isModified = false;
        }

        function importfromjson() {
            myDiagram.model = go.Model.fromJson(document.getElementById("mySavedModel").value);
        }

        function download(text, name, type) {
            var a = document.createElement("a");
            var file = new Blob([text], {
                type: type
            });
            a.href = URL.createObjectURL(file);
            a.download = name;
            a.click();
        }

        function savetofile() {
            download(myDiagram.model.toJson(), 'organon.json', 'text/plain');

        }

        function handleFileSelect(evt) {
            var f = evt.target.files[0]; // FileList object

            // files is a FileList of File objects. List some properties.
            var reader = new FileReader();
            // Closure to capture the file information.
            reader.onload = (function(theFile) {
                return function(e) {
                    myDiagram.model = go.Model.fromJson(e.target.result);
                };
            })(f);
            reader.readAsText(f);
        }
        function ajouterPremisses(){
            myDiagram.startTransaction("Ajout de premisses");
            premisses = document.getElementById("premisses").value.split("\n");
            if (premisses.length >= 1){
                for (var i = 0; i < premisses.length; i++){
                    if (i === 0) myDiagram.selectCollection(myDiagram.nodes);
                    if (premisses[i].trim().length >= 1){
                        myDiagram.model.addNodeData({
                            text:premisses[i].trim(),
                            loc: spiralLoc(i)
                        });
                        console.log(spiralLoc(i));
                    }
                }
            }
            myDiagram.commitTransaction("Ajout de premisses");
        }
        function spiralLoc(i){
            var a = 30;
            var n = 1;
            var x = a*Math.pow(i,1/n)*Math.cos(i);
            var y = a*Math.pow(i,1/n)*Math.sin(i);
            return x.toString() + " " + y.toString();
        }
    </script>
</head>

<body onload="init()">
    <h1>Visualisation de logique</h1>
    <div id="sample">
        <div id="myDiagramDiv" style="border: solid 1px black; width:100%; height:600px;"></div>
        <div>
            <div id="clavierlogique">
                <button id="ajoutPremisses" onclick="ajouterPremisses()">Ajouter les prémisses</button>
            </div>
            <textarea id ="premisses" style="width:100%;height:400px">
Test1
Test2
Test3
Test4
Test5
Test6
Test7
Test8
Test9
Test10
Test11
Test12
Test13
Test14
Test15</textarea>

        </div>
        <div>
            <div>
                <button id="ExportButton" onclick="exporttojson()">Exporter</button>
                <button onclick="importfromjson()">Importer</button> Diagram.model en format JSON:<br />
            </div>
            <div>
                <button id="SaveButton" onclick="savetofile()">Télécharger</button>
                <input type="file" id="files" name="file" />

                <script>
                </script>
            </div>
            <textarea id="mySavedModel" style="width:100%;height:400px">

      </textarea>
        </div>
    </div>
</body>

</html>